Fork for training_loop.py changes so I can use in colaboratory notebook
